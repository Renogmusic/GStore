@using GStore.AppHtmlHelpers
@using GStore.Controllers
@using GStore.Controllers.BaseClass
@using GStore.Models
@using GStore.Models.ViewModels
@using GStore.Data
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	@{
		GStore.Models.StoreFront storeFront = Html.CurrentStoreFront(false);
		GStore.Models.Client client = Html.CurrentClient(false);
		GStore.Models.Page page = Html.CurrentPage(false);

		string title = string.Empty;
		UserProfile userProfile = Html.CurrentUserProfile(false);

		title = (storeFront == null ? "GStore" : storeFront.Name);

		if (page != null && !string.IsNullOrWhiteSpace(page.PageTitle))
		{
			title = page.PageTitle + " - " + title;
		}

		if (ViewBag.Title != null && !string.IsNullOrWhiteSpace(ViewBag.Title))
		{
			title = ViewBag.Title + " - " + title;
		}

		string metaApplicationName = "GStore Store Front";
		string metaApplicationTileColor = "880088";
		string metaDescription = "GStore Store Front";
		string metaKeywords = "GStore Store Front";
		string bodyTopScriptTag = string.Empty;
		string bodyBottomScriptTag = string.Empty;

		string themeFolderName = Html.ThemeFolderName();
		if (storeFront != null)
		{
			if (!string.IsNullOrEmpty(storeFront.MetaApplicationName))
			{
				metaApplicationName = storeFront.MetaApplicationName;
			}
			if (!string.IsNullOrEmpty(storeFront.MetaApplicationTileColor))
			{
				metaApplicationTileColor = storeFront.MetaApplicationTileColor;
			}
			if (!string.IsNullOrEmpty(storeFront.MetaDescription))
			{
				metaDescription = storeFront.MetaDescription;
			}
			if (!string.IsNullOrEmpty(storeFront.MetaKeywords))
			{
				metaKeywords = storeFront.MetaKeywords;
			}
			if (!string.IsNullOrEmpty(storeFront.BodyTopScriptTag))
			{
				bodyTopScriptTag = storeFront.BodyTopScriptTag;
			}
			if (!string.IsNullOrEmpty(storeFront.BodyBottomScriptTag))
			{
				bodyBottomScriptTag = storeFront.BodyBottomScriptTag;
			}
		}

		if (page != null)
		{
			if (!string.IsNullOrEmpty(page.BodyTopScriptTag))
			{
				bodyTopScriptTag = page.BodyTopScriptTag;
			}
			if (!string.IsNullOrEmpty(page.BodyBottomScriptTag))
			{
				bodyBottomScriptTag = page.BodyBottomScriptTag;
			}
			if (!string.IsNullOrEmpty(page.MetaDescription))
			{
				metaDescription = page.MetaDescription;
			}
			if (!string.IsNullOrEmpty(page.MetaKeywords))
			{
				metaKeywords = page.MetaKeywords;
			}
			if (!string.IsNullOrEmpty(page.MetaApplicationName))
			{
				metaApplicationName = page.MetaApplicationName;
			}
			if (!string.IsNullOrEmpty(page.MetaApplicationTileColor))
			{
				metaApplicationTileColor = page.MetaApplicationTileColor;
			}
		}


		MenuViewModel menuViewModel = Html.MenuViewModel(storeFront, userProfile);

	}
	<title>@title</title>

	<meta name="application-name" content="@(metaApplicationName)" />
	<meta name="msapplication-TileColor" content="#@(metaApplicationTileColor)" />
	<meta name="msapplication-square70x70logo" content="~/Images/Logo/tiny.png" />
	<meta name="msapplication-square150x150logo" content="~/Images/Logo/square.png" />
	<meta name="msapplication-wide310x150logo" content="~/Images/Logo/wide.png" />
	<meta name="msapplication-square310x310logo" content="~/Images/Logo/large.png" />

	<link rel="shortcut icon" href="~/Images/favicon.ico" type="image/x-icon">
	<link rel="icon" href="~/Images/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="~/Images/Logo/square.png" />
	<link rel="apple-touch-startup-image" href="~/Images/Logo/square.png" />

	<meta name="description" content="@(metaDescription)" />
	<meta name="keywords" content="@(metaKeywords)" />

	<script>
		var userName = @(Html.Raw((User.Identity.IsAuthenticated ? "'" + this.Ajax.JavaScriptStringEncode(User.Identity.Name) + "'": "null" )));
		var googleAnalyticsWebPropertyId = @(Html.GoogleAnalyticsWebPropertyIdValueJs(storeFront));
	</script>

	@Styles.Render("~/Themes/" + themeFolderName + "/Bootstrap.min.css")
	@Styles.Render("~/Styles/GStoreApp.css")
	@Styles.Render("~/Styles/Styles.css")

	@Scripts.Render("~/bundles/modernizr")
	@Scripts.Render("~/bundles/jquery")
	@Scripts.Render("~/bundles/jqueryval")
	@Scripts.Render("~/bundles/jqueryui")
	@Scripts.Render("~/bundles/bootstrap")
	<script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
	<script src="~/signalr/hubs"></script>
	@Scripts.Render("~/Js/GStoreApp.js")
	@Scripts.Render("~/Js/Scripts.js")
</head>
<body>
	@if (page != null)
	{
		@Html.Raw(bodyTopScriptTag)
	}
	@Html.Partial("_NavbarPartial", menuViewModel)
	@{
		string classes = string.Empty;
		RouteData routeData = ViewContext.RouteData;
		if (routeData != null)
		{
			if (routeData.DataTokens.ContainsKey("area"))
			{
				classes += " area-" + routeData.DataTokens["area"].ToString().ToLower();
			}
			classes += " controller-" + routeData.Values["controller"].ToString().ToLower();
			classes += " action-" + routeData.Values["action"].ToString().ToLower();
		}

	}
	<div class="container body-content@(classes)">
		<!-- top alert container for dynamic alerts-->
		<div id="usermessagecontainer"></div>
		@RenderBody()
		<hr />
		<div id="usermessagebottomcontainer"></div>
		@Html.Partial("_FooterPartial")
	</div>

	@RenderSection("scripts", required: false)

	@Html.RenderUserMessages()
	@Html.RenderUserMessagesBottom()
	@Html.RenderAnnouncements()
	@Html.RenderGaEvents()
	@if (page != null)
	{
		@Html.Raw(bodyBottomScriptTag)
	}
</body>




</html>
